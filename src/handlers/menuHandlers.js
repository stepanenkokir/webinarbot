// src/handlers/menuHandlers.js
import { getMainMenu } from "../keyboards/mainMenu.js"
import { getWebinarInlineMenu, getContactsMenu } from "../keyboards/webinarMenu.js"
import { findUserByTelegramId } from "../database/userRepository.js"
import config from "../config/config.js"

// –û–±—Ä–∞–±–æ—Ç–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É"
export const handleGetLink = async (ctx) => {
	try {
		// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID
		const user = findUserByTelegramId(ctx.from.id)

		if (user) {
			// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
			await ctx.reply(`${user.name}, –≤–æ—Ç –≤–∞—à–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä:`)
			await ctx.reply(config.WEBINAR_LINK, {
				disable_web_page_preview: false,
				...getWebinarInlineMenu(),
			})
		} else {
			// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
			ctx.reply('–í—ã –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ "üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä" –∏–∑ –º–µ–Ω—é.')
		}
	} catch (error) {
		console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å—Å—ã–ª–∫—É:", error)
		ctx.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –ø–æ–∑–∂–µ.")
	}
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ "–û –≤–µ–±–∏–Ω–∞—Ä–µ"
export const handleAboutWebinar = (ctx) => {
	const { title, date, time, speaker, topic } = config.webinarInfo

	ctx.reply(
		`üìö *–û –Ω–∞—à–µ–º –≤–µ–±–∏–Ω–∞—Ä–µ*\n\n` +
			`–ù–∞—à –≤–µ–±–∏–Ω–∞—Ä –ø–æ—Å–≤—è—â–µ–Ω —Ç–µ–º–µ: ${topic}.\n\n` +
			`üóì *–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è*: ${date}\n` +
			`‚è∞ *–í—Ä–µ–º—è*: ${time}\n` +
			`üë®‚Äçüè´ *–°–ø–∏–∫–µ—Ä*: ${speaker}\n\n` +
			`üìã *–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–µ–±–∏–Ω–∞—Ä–∞*:\n` +
			"- –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ\n" +
			"- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å\n" +
			"- –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã\n\n" +
			"–ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ! –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å–µ–π—á–∞—Å.",
		{
			parse_mode: "Markdown",
			...getWebinarInlineMenu(),
		}
	)
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏"
export const handleContactUs = (ctx) => {
	const { email } = config.contacts

	ctx.reply(`–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏:\n\n` + `üìß Email: ${email}\n` + `–ò–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö:`, getContactsMenu())
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
export const handleUnknownCommand = (ctx) => {
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –æ–¥–Ω–æ–π –∏–∑ –∫–æ–º–∞–Ω–¥ –º–µ–Ω—é
	const menuCommands = ["üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä", "üîó –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É", "üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏", "‚ÑπÔ∏è –û –≤–µ–±–∏–Ω–∞—Ä–µ", "‚ùì –ü–æ–º–æ—â—å", "–û—Ç–º–µ–Ω–∞"]

	if (!menuCommands.includes(ctx.message.text)) {
		ctx.reply("–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.", getMainMenu())
	}
}
